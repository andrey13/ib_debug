/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/morpher-ru@0.1.1/index.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";const crypto=require("crypto"),MorpherError=require("./src/error"),Client=require("./src/client"),Storage=require("./src/storage"),Morpher=require("./src/morpher"),EntityDeclension=require("./src/entity/declension"),EntityName=require("./src/entity/name"),EntityNumber=require("./src/entity/number");function MorpherAPI(e,r){e&&e instanceof Storage&&(r=e,e={}),this.morpher=new Morpher(new Client(e)),this.setStorage(r)}MorpherAPI.Storage=Storage,MorpherAPI.prototype.setStorage=function(e){if(e||(e=new Storage),!(e instanceof Storage))throw new MorpherError("Storage object must be instance of morpher.Storage");this.storage=e},MorpherAPI.prototype.hash=function(e){return crypto.createHash("sha256").update(e).digest("hex")},MorpherAPI.prototype.declension=function(e){return new Promise((r,t)=>{let n=e.trim();if(!n.length)return t(new MorpherError(`Ошибка запроса: "${e}"`));let o=this.hash(n.toLowerCase());this.storage.get("text",o).then(e=>{e?r(new EntityDeclension(e,!0)):this.morpher.declension(n).then(e=>this.storage.set("text",o,e).then(e=>r(new EntityDeclension(e)),e=>t(e)),e=>t(e))},e=>t(e))})},MorpherAPI.prototype.declensionName=function(e){return new Promise((r,t)=>{if(!(e=this.morpher.fullName(e)).length||-1===e.indexOf(" "))return t(new MorpherError(`Ошибка запроса: "${e}"`));let n=this.hash(e);this.storage.get("name",n).then(o=>{o?r(new EntityName(o,!0)):this.morpher.declensionName(e).then(e=>this.storage.set("name",n,e).then(e=>r(new EntityName(e)),e=>t(e)),e=>t(e))},e=>t(e))})},MorpherAPI.prototype.declensionNumber=function(e,r){return new Promise((t,n)=>{let o=this.morpher.prepareNumber(e,r);if(isNaN(o.number))return n(new MorpherError(`Ошибка запроса: ${e} is NaN`));if(o.number<0)return n(new MorpherError(`Ошибка запроса: ${e} < 0`));let i=this.hash(o.unit+o.number.toString());this.storage.get("number",i).then(e=>{e?t(new EntityNumber(e,!0)):this.morpher.declensionNumber(o).then(e=>this.storage.set("number",i,e).then(e=>t(new EntityNumber(e)),e=>n(e)),e=>n(e))},e=>n(e))})},module.exports=MorpherAPI;
//# sourceMappingURL=/sm/f47e557b1b0b739f64edbe2d2374f3c8a924da04a0482aa969892be98556bde9.map